水力侵蚀模型

一、关于水力侵蚀模型

文章中提出的水力侵蚀模型被分解分为五步。在进入模型之前，我们首先描述必要的数学符号：

地形高度b，水高d，悬浮沉积物量s，流出通量f，速度矢量v。

为2D网格的每个单元格存储这些值在模拟过程中保持最新。所以我们需要多层2D阵列进行数据存储。

我们的水力侵蚀模型分解为五步：

①因为降雨或者是河源，水量增加

②用浅水模型模拟流动，然后速度场和睡眠都会更新。

③利用速度计算侵蚀沉积过程领域。

⑤蒸发导致水分减少。

在文章中，我们因为几个元素符号拓展出来若干符号：bt，dt，st，ft等等，我们对于dt，表示的就是时间t的水高。对于△t
时间后的变化，其值为：dt+△t；

由于两个主要的影响，新的水出现在地形上：降雨量和河流来源。对于这两种类型，我们需要指定位子，半径和水强度期间达到的
水量。对于河流来源，水源的位子是固定的。对于降雨，每个雨滴随机分布落在地形上。让rt是每个时间单位到达单元格的水，
那么水高度通过简单的公式就能够添加更新：

D（x，y）=dt（x，y）+△t*rt(x，y)；

接下来我们首先描述如何计算流出通量f，我们基于管道模型，然后更新睡眠d和速度场~v与f。

如之前所述，我们调整了管道模型模拟水的流动。在管道模型中，单元格通过相邻的格子来交换水进行模拟管道。
为每个管道保持“流速”；

为了避免与速度矢量v混淆，我们使用术语“通量”来代替流速。在每一步，通过流体静压力差来加速通量
通过管道连接的两个单元。然后是水单元格中的高度（x，y）通过积累更新来自所有虚拟管道的通量值。
如果更新水高度为负，所有管道都从中移除液体、但是这个抽象的过程无法轻松的映射到GPU，因为涉及
2D网格上的依赖数据处理在这个过程中，在GPU是无法承受的。我们通过限制流出通量来解决这个问题。
我们只存储每个细胞的流出通量值f、fL是指从一个格子（x，y）到其左邻居的流出通量。左边邻居肯定
就是（x-1，y）；fB，fT，fR的定义和刚刚所述基本等同。如果流出通量值的和超过水量单元格f将按比例
缩小K因子来避免负数更新水位。

那么我们有：

![](https://i.loli.net/2018/07/23/5b55969b21409.png)

其中，A是管道的横截面积，g是加速度，l是虚拟管道的长度。△hL（x，y）是单元格（x，y）和他左边邻居（x-1，y）
之间的高度差。

![](https://i.loli.net/2018/07/23/5b5597820c383.png)

对于详细的推导，我们流出通量的比例因子K：

![](https://i.loli.net/2018/07/23/5b559808be86b.png)

这里边，lX，lY表示的是在X轴方向和Y轴方向的距离（两个格子之间）。

那么我们有了因子K之后，可以有公式：

![](https://i.loli.net/2018/07/23/5b55985939d95.png)

二、水面和速度矢量的更新

用新的流出通量场来更新水高通过收集来自各个邻居的流入通量以及将流出通量fout从当前单元发送出去，
对于单元格:（x，y），水的净体积变化为：

![](https://i.loli.net/2018/07/23/5b559b1d4831c.png)

对于水高的更新：

![](https://i.loli.net/2018/07/23/5b559b3215c7e.png)

接下来，速度矢量v对于侵蚀沉积是必要的模型。以及沉积物运输业是必要的。
我们仅考虑水平速度在我们的研究中，~v是可以很容易的从流出量计算出来的。通过的平均水量可以表示X方向上每单位时间的单元格子（x，y）：

![](https://i.loli.net/2018/07/23/5b559bd191f78.png)

对于任何流体模拟方法，边界条件应该考虑到。由于流动是模拟在2D网格上的。我们假设没有水可以流出网格。
我们指定边界上单元的流出量为0即可。

管道模型可以看做是一种显示方法对于浅水方程来讲。数值的稳定性解决方案由时间长度△t来确定。最大值时间长度收到各种因素的影响限制。
例如格子大小、边界条件等。缩放步骤也可能导致不稳定系统。如果一个细胞的流出量按照比例缩放因子K，应该调整其邻居的流出量相应的避免
流量中的数值误差速率，在之前的方法中我们没有考虑。对于我们的模型，一个单元的新值是从其四个邻居计算出来的。因此，可以近似地表达
该限制CFL条件：△t*u<=LX,△t*v<=LY。当网格的大小增加（LX,LY减少）的时候，我们应按照比例减少时间长度以来保持稳定的仿真效果。

虽然所有方程式都在管道模型中引入可以很容易的拓展到所有八个邻居的格子，但是在实践中发现四个邻居就可以产生满意的效果。

三、侵蚀和沉积

当水流过地形的时候，一些土壤将被水侵蚀和匀运输，一些悬浮的沉积物将沉积在地面上。这种侵蚀沉积的过程主要屈居于流体的
沉积物运输能力。这个数量收到许多因素的限制，并且在土壤科学中已经提出了许多预测模型。我们采用简化的经验公式来模拟过程
单元中水流的沉积物运输能力C（x，y）计算如下：

![](https://i.loli.net/2018/07/24/5b5690e5e6cde.jpg)

其中，Kc是沉积物容量常熟，α（x，y）是局部倾斜角，~v是速度值。注意，C的计算有一个限制：对于α值接近零的非常地形，C将非常小，这
意味着水流将从地面吸收非常少的土壤，并且侵蚀效果肯定非常不明显。通过用用户指定的最小阈值限制α值可以解决缓解这个问题。然后我们将
C与悬浮沉积物s进行比较，以确定侵蚀沉积过程。如果C>St，一些土壤溶解在水中并添加到悬浮的沉积物中：

![](https://i.loli.net/2018/07/24/5b5691de7a64c.jpg)









































