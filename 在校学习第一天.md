关于GameDev上实例的参考学习：

一、任务背景：
在开放的景观游戏中，河流可以为地形的外观增添逼真的触感。
我将讨论一种将河流添加到随机生成的地形的方法，该方法增加了我们正在寻找的这种逼真的触感。 
不幸的是，当我们处理随机地形时，这并不总是一项琐碎的任务。
在现实生活中，地形通常通过在陆地上雕刻出水并形成山谷和其他这样的地形特征来形成。 
然而，当在体面的加载时间产生地形时，我们没有这种奢侈。
我在Full Sail的最后一个项目是一个名为列日的实时战术游戏，随机生成河流地形。 
在整篇文章中，我将讨论我为列日创建河流所采用的方法。

二、任务关键（算法的关键部分）：

1.用于确定河流路径的路径搜索算法。

2.一种算法来清理河流周围的地形。

3.河床雕刻算法。

三、关于路径：

①路径是整个过程的关键部分，因为一条不遵循现实路径的河流不会和真实的河流一样。
为了达到目的，我们要做的第一件事就是创建地图上所有边缘顶点的高度排序数组。
为了确保我们将选择一条尽可能下坡的路径，我们将随机的去选取边缘顶点。那么我们在
高度排序数组中，取起点在前五分之三高的边缘顶点中的随机一个。然后再取终点在后五分之一
矮的边缘顶点中的随机一个。那么此时我们就得到了起点和终点。如果我们的地图比较小的话
建议我们在选取起点和终点的时候，将其选择在相反的边缘的两个点作为起点和终点。

②现在我们有了河流的起点和终点，我们需要一种计算路径的方法，要做到这一点，
我们将利用我们的优势，即水承受重力的影响。改变一个简单的“最好”的路径寻找算法。
使用一种启发式算法来衡量相邻节点的高度，以便与目标保持距离，我们可以得到一条
相当实际的路径。

③已经形成的路径会出现几个问题。路径的第一个问题是，地形并非由河流组成，因此河流
不可能始终从头至尾完成流动。而且甚至有些稍许上坡。我们将需要改变地形，让河流
总是实际向下流动。该路径的另一个问题是，当路径与地图的边缘相交而且在到达其终点之前
当他没有地形行进到地形边缘之外时，它倾向于坚持边缘，并且如果他是驱动到地图的边缘，
然后低于地图的内部，这将导致部分河流“贴”到地图的边缘。


四、清理路径：

①“贴”到地图边缘的丑恶作用之一就是，河流倾向于在碰到边缘时跳跃，然后折断，然后撞击
边缘然后再次折断。有时候它可能看起来像一条跳跃的线，只不过是从某个地方返回的河流，
但在其他时候它看起来很可怕。所以作为一种解决方案，建议我们通过河流节点寻找河流中
的最长的一次跳跃，在我们还没有击中开始和目标节点之间的边缘的情况下，找到这个最长的一跳
一旦我们找到了，将其他所有跳跃节点删除掉即可。

②另外一个问题是啤酒花。河流在地形边缘的河流宽度内的地方，会导致可见的啤酒花。这个问题
很容易解决。我只是穿过河流，测试每个节点相对于地图边缘的相对距离，如果距离太近，我只是将他
向内移动。河流的路径应该看起来足够逼真，推动这些少数节点看起来不会很糟糕。

③现在我们已经完善了实际的路径，我们需要调整路径的高度，目前它正在铺设在地形的表面上。
我们想要坐的是将每个顶点沿着Y轴向下移动到其当前位子减去河流深度的一半或者比先前节点
低的一个点，取其中较为低的点，在这样做的过程中，我们确信河流的路径总是向下流动。
由于我们拥有这样新的高度，因此我们还需要调整每个相应河流顶点的高度图中存储的高度，如果
愿意的话，这样做会刮擦路径进入地形。

④所以我们首要完成的任务，就是要保证路径是精确的、完美的、不可逆高度的。实际解决这部分问题：

```c#

for( i = m_vp3River.size()-1; i >= 0 ; i-- )
{

  //首先我们需要将实际地图高度，转化为高度图坐标

   int iRX = int(m_vp3River[i].x/m_MapInfo.fScale),
      iRZ = int(m_vp3River[i].z/m_MapInfo.fScale);
  //然后我们将所有点的高度降低河流深度的一半
  m_vp3River[i].y -= HALFDEPTH*m_MapInfo.fScale;
  
}

```










