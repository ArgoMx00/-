`介绍`

这是一个相当简短的课程，他将教你如何使用点光源。点光源是方向灯的一种。意味着他们需要更多的计算，并为场景添加更多真实感。

`点光因子`

在创建点光源的时候呢，我们需要更多的值。我们需要定义他的位子，范围以及衰减。

位子：这将由我们的代码中名为pos的3D向量表示。虽然点光源没有方向灯和聚光灯那样的方向。但是由于他们在每个可能的方向上都会发光。所以他们必须有一个位子。

范围：范围将由我们的代码中名为range的浮点数表示。来自聚光灯的灯光不会像定点光那样永远持续下去。

衰减：这将由我们的代码中名为att的3D向量表示，其中三个值将分别称为att0，att1和att2.这需要比其他两个更多的解释。衰减用于控制光强度和如何随着光源的距离
增加变化而减小。衰减的计算如下：

```c++
Attenuation = att0 + (att1 * d) + (att2 * d²)
```

其中d是光源和像素之间的距离，现在我们将更加详细的解释这些衰减因子中的每一个内容。

att0  - 常量修饰符

由于此值未乘以任何值，因此称为“常量修改器”，这意味着此值不会随着从光源到像素的距离的变化而变化。该值用于为光源范围内的所有物体提供最小量的光。如果您要将此值设置为“1.0f”，那么光源范围内的所有内容都将具有全彩或全光。

att1  - 线性修改器

您可以看到此值乘以光源和像素之间的距离，或乘以等式中的d。这使得该值成为“线性修改器”，这意味着随着像素和光源之间的距离增加，这将逐渐减少像素获得的光量。这可能是最现实的因素。

att2  - 指数修饰符

此值乘以d的平方，使该值成为“指数修饰符”。使用此值会使非常接近光源的物体获得大量光线，但随着它们移开，它们接收到的光迅速减小，然后随着距离越来越慢。

`点光方程`

它不是一个实际的等式。而更像是一系列正确的点亮光源的步骤和方程式。

从光微子矢量的像素方向。

首先，我们将创建一个向量。来描述光线照射像素的方向。我们可以这样做：

```c++
lightToPixelVec = light.pos - input.worldPos;
```

在上一课，Directional Light课程以及之前的课程中，我们只需要从VS阶段向屏幕空间发送顶点位子。但是我们的灯光位子是在世界空间中被定义的。因此我们
需要从VS以及顶点的屏幕空间发送顶点世界空间位子。在上一课中，我们再世界空间中发送了顶点法线。因此您不应该再将世界空间中的顶点实际位子发送到PS遇到问题。

像素位子与光线位子之间的距离。

现在我们将使用刚创建的矢量找到像素位子和灯光之间的距离。然后我们可以确定该像素是否在光范围之外。我们可以用名为length()函数找到向量的长度。

```
d = length(lightToPixelVec);
```

如果d大于我们的光的范围因子，那么像素不会从我们的光源接收光。我们可以返回环境值，如果你想要的话，可以调的更暗或者更亮。

规范化LightToPixelVec Vector

```
lightToPixelVec /= d; 
```

`光照强度`

就像我们上一节课中所做的那样。我们现在必须发现光线对像素表面有多么强烈的影响。如果光线“正面”撞击表面，那么表面将接受所有光线。如果光源位于表面
后边或者与表面平行，则表面不糊发光。我们可以通过将广大额方向乘以像素法线的像素来找到这个因子。

```
howMuchLight = dot(lightToPixelVec, input.normal);
```

`将光强度添加到像素`

```
finalColor += howMuchLight * diffuse * light.diffuse;
```

添加衰减因子：

```
finalColor /= light.att[0] + (light.att[1] * d) + (light.att[2] * (d*d));
```

```
struct Light
{
    Light()
    {
        ZeroMemory(this, sizeof(Light));
    }
    XMFLOAT3 dir;
    float pad1;
    ///////////////**************new**************////////////////////
    XMFLOAT3 pos;
    float range;
    XMFLOAT3 att;
    float pad2;
    ///////////////**************new**************////////////////////
    XMFLOAT4 ambient;
    XMFLOAT4 diffuse;
};
```

`描述光`

在这里我们描述我们的光，位子设置为（0,0,0）其范围是100.f其衰减的att1位0.2f，浙江使其具有恒定的衰减系数。

```
light.pos = XMFLOAT3(0.0f, 0.0f, 0.0f);
light.range = 100.0f;
light.att = XMFLOAT3(0.0f, 0.2f, 0.0f);
light.ambient = XMFLOAT4(0.3f, 0.3f, 0.3f, 1.0f);
light.diffuse = XMFLOAT4(1.0f, 1.0f, 1.0f, 1.0f);
```

`更新灯光位子`

```
XMVECTOR lightVector = XMVectorSet( 0.0f, 0.0f, 0.0f, 0.0f );

lightVector = XMVector3TransformCoord(lightVector,cube1World);

light.pos.x = XMVectorGetX(lightVector);
light.pos.y = XMVectorGetY(lightVector);
light.pos.z = XMVectorGetZ(lightVector);
```

最后我们再更新一下我们的着色器文件即可。













