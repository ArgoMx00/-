今天我们依旧抛开地形的美观问题。尝试开始创建河床。

一、功能描述

①尝试用鼠标点击一定量的地形点之后，在这些点构成的路径上，构成一条河床出来。

②当然我们肯定不能一边点击地形就随意将地形凹陷下去没有规律的去做，所以我们尝试点击足够多的点之后，按动键盘上的空格键之后。再构建出凹槽。
</br></br>

二、首先收集点选的点，将其集合进行存储并且初步处理。

①我们首先点选一部分点，然后按下空格键输出所有收集到的点的信息。代码如下：

```c#
/*
任务目标：
在地形上点选一部分点，然后按下空格键输出收集到的点的信息。
*/
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class DynamicCreateTerrain : MonoBehaviour {
    //注意重新将脚本拖入GameObject的时候，将初始化的东西都要初始化一下。
    //首先我们需要采集地形信息，所以我们首先创建出来一个terrainData
    //用来存储需要采集的地形的信息。
    //TerrainData类中元素：http://www.manew.com/youxizz/2763.html
    public TerrainData terrainData;
    //用于存地形高度图的
    private float[,] heightmaps;

    //得到在代码中的长和宽。
    int width;
    int height;
    
    //鼠标点击的点
    Vector3 P;
    //实际地形图中的信息：
    public int realWidth;
    public int realheight;
    public int heightResolution;

    //用于保存收集点的信息
    int cnt;
    Vector3[] m_vp3River = new Vector3[10000];
    void Start()
    {
        cnt = 0;
        GetHeightmaps();
       // Change();
    }
    void GetP(Vector3 P)
    {
        print("调用成功,得到鼠标点击点：  "+(int)P.x+" -- "+(int)P.y+" -- "+(int)P.z);
        //拿到点选的点的信息之后，我们将其保存起来。
        m_vp3River[cnt].x = P.x;
        m_vp3River[cnt].y = P.y;
        m_vp3River[cnt].z = P.z;
        cnt++;
    }
    //将点选的点周围15x15的格子统一提升一定量高度。
    void RegularUpTerrain(Vector3 P)
    {
        float Bilv1 = (float)(heightResolution) / (float)(realWidth);
        float Bilv2 = (float)(heightResolution) / (float)(realheight);
        int tx = (int)(P.x * Bilv1);
        int tz = (int)(P.z * Bilv2);

        //接下来需要通过计算来得到点的高度图横纵坐标。
        print(tx + "----------------" + tz);
        GetHeightmaps();
        for (int i = -15; i <= 15; i++)
        {
            for (int j = -15; j <= 15; j++)
            {
                int xx = tx + i;
                int zz = tz + j;
                if (xx >= 0 && xx < width && zz >= 0 && zz < height)
                {
                    //坐标在实际展示中是反着的。
                    heightmaps[zz, xx] += 0.01f;
                }
            }
        }
        //设置高度图
        terrainData.SetHeights(0, 0, heightmaps);
    }
    //得到当前地形的高度图。
    void GetHeightmaps()
    {
        width = terrainData.heightmapWidth;
        height = terrainData.heightmapHeight;
        heightmaps = terrainData.GetHeights(0, 0, width, height);
        //print(width + "---" + height);
    }
    //将指定范围内点提升到指定高度。
    void Change()
    {
        for (int i = 300; i < 350; i++)
        {
            for (int j = 300; j < 350; j++)
            {
                heightmaps[i, j] = 0.9f;
            }
        }
        terrainData.SetHeights(0, 0, heightmaps);
    }
    private void Update()
    {
        if(Input.GetKey(KeyCode.Space))
        {
            print("所有点选点的信息：");
            for(int i=0;i<cnt;i++)
            {
                print(m_vp3River[i].x + " - " + m_vp3River[i].y + " - " + m_vp3River[i].x);
            }
        }
    }
}

```

实际达成效果：

![](https://i.loli.net/2018/06/02/5b11f2706a4ac.png)

